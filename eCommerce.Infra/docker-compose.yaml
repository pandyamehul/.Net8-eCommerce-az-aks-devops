services:
  ecomm.net9.aks.pg.userdb:
    image: postgres
    container_name: ecomm.net9.aks.pg.userdb
    hostname: ecomm.net9.aks.pg.userdb
    restart: always
    ports:
      - "5433:5432"
    volumes:
      - ecomm.net9.aks.pg.userdb.storage:/var/lib/postgresql/data
      - ../eCommerce.UserService/UserService.Db.Script:/docker-entrypoint-initdb.d
    environment:
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=postgres
      - POSTGRES_DB=eCommerceUsers
    networks:
      - ecomm.net9.aks.pg.userdb.network

  ecomm.net9.aks.mysql.productdb:
    image: mysql:latest
    container_name: ecomm.net9.aks.mysql.productdb
    hostname: ecomm.net9.aks.mysql.productdb
    restart: unless-stopped
    environment:
      MYSQL_ROOT_PASSWORD: mysql-secret-pw
      MYSQL_DATABASE: eCommerceProducts
      MYSQL_USER: mysqluser
      MYSQL_PASSWORD: mysqlpassword
    ports:
      - 3306:3306
    volumes:
      - ecomm.net9.aks.mysql.productdb.storage:/var/lib/mysql
      - ../eCommerce.ProductService/ProductService.Db.Script:/docker-entrypoint-initdb.d
    networks:
      - ecomm.net9.aks.mysql.productdb.network

  ecomm.net9.aks.mongo.orderdb:
    image: mongo:latest
    container_name: ecomm.net9.aks.mongo.orderdb
    hostname: ecomm.net9.aks.mongo.orderdb
    restart: unless-stopped
    ports:
      - 27018:27017
    volumes:
      - ecomm.net9.aks.mongo.orderdb.storage:/var/lib/mongodb
      - ../eCommerce.OrderService/OrderService.Db.Script:/docker-entrypoint-initdb.d
    networks:
      - ecomm.net9.aks.mongo.orderdb.network

  ecomm.net9.aks.redis.cache:
    image: redis:latest
    container_name: ecomm.net9.aks.redis.cache
    hostname: ecomm.net9.aks.redis.cache
    restart: unless-stopped
    ports:
      - 6380:6379
    volumes:
      - ecomm.net9.aks.redis.cache.storage:/data
    networks:
      - ecomm.net9.aks.network

  ecomm.net9.aks.msg.queues:
    image: rabbitmq:management
    container_name: ecomm.net9.aks.msg.queues
    hostname: ecomm.net9.aks.msg.queues
    restart: always
    ports:
      - "5673:5672"
      - "15673:15672"
    volumes:
      - ecomm.net9.aks.msg.queues.storage:/var/lib/rabbitmq
    environment:
      - RABBITMQ_DEFAULT_USER=guest
      - RABBITMQ_DEFAULT_PASS=guest
    networks:
      - ecomm.net9.aks.network

volumes:
  ecomm.net9.aks.pg.userdb.storage:
  ecomm.net9.aks.mysql.productdb.storage:
  ecomm.net9.aks.mongo.orderdb.storage:
  ecomm.net9.aks.redis.cache.storage:
  ecomm.net9.aks.msg.queues.storage:

networks:
  ecomm.net9.aks.network:
    name: ecomm.net9.aks.network
    driver: bridge
  ecomm.net9.aks.pg.userdb.network:
    name: ecomm.net9.aks.pg.userdb.network
    driver: bridge
  ecomm.net9.aks.mysql.productdb.network:
    name: ecomm.net9.aks.mysql.productdb.network
    driver: bridge
  ecomm.net9.aks.mongo.orderdb.network:
    name: ecomm.net9.aks.mongo.orderdb.network
    driver: bridge
